# AWS S3 Signed URL Generator Microservice

## Introduction
The AWS S3 Signed URL Generator is a microservice designed to facilitate secure 
and controlled access to objects stored in private AWS S3 buckets. It provides 
signed URLs that enable users to upload and/or download files directly from an 
S3 bucket, without making the objects publicly accessible. This microservice is 
a valuable tool for applications that require fine-grained access control to S3 
resources.

## Use cases
The signed URLs generated by this microservice serve various important use cases:

<b>Client-Side Uploads:</b> Allows client-side applications to
upload pictures and other types of files directly to an S3 bucket without 
the need to route the data through a backend server.

<b>Access to Private Files:</b> Grant client-side applications access to private 
files stored in an S3 bucket securely. This can be especially useful when 
you want to share specific resources with external applications or users.

## Features

<b>Signed URL Generation:</b> Create time-limited and secure URLs for uploading 
and downloading objects from private S3 buckets.

<b>Customizable Access Rights:</b> Define the level of access (read and/or write) 
for each generated signed URL.

<b>Flexible Expiry:</b> Set an expiration time for the signed URLs to control 
access duration. The default expiration time is 60 minutes, and the maximum is 7 days.

<b>Secure and Tokenized:</b> Utilizes AWS Signature Version 4 to ensure 
security and prevent tampering.

<b>Easy Integration:</b> Provides and easily accessible REST API for other applications.

<b>API-key Authentication:</b> Prevent unauthorized access by using API keys for authentication.

<b>JWT Authentication:</b> Coming soon with AWS Cognito integration.

## Prerequisites
This application assumes 

## Usage
0. Clone the repository
```
git clone https://github.com/szabolcsgarda/aws-s3-signed-url-generator.git'
cd aws-s3-signed-url-generator
```

### Deployment on your machine
13. Install dependencies
```
npm install
```

2. Set the required environment variables
See below the Environment variables section for details.

3. Start the server

```
npm run-script run
```

### Build Docker image
1. Build the Docker image
```
docker build -t aws-s3-signed-url-generator -f Dockerfile-dev .
```

2. Run the Docker container
The application is conveniently deployable as a Docker container, offering flexibility 
and ease of scaling. However, it's important to note that by default, the Docker 
container does not have access to the host machine's AWS secrets. Consequently, 
it cannot generate signed URLs out of the box.
To overcome this limitation, the Docker container is ideally suited for deployment 
within Amazon Web Services (AWS) Elastic Container Service (ECS). In an AWS ECS 
environment, you can attach the necessary Identity and Access Management (IAM) roles, 
granting the container the permissions it requires to securely access your private 
S3 bucket. This seamless integration ensures that the microservice can effectively 
generate signed URLs while maintaining the security of your AWS resources.
```
docker run -p 3000:3000 -e API_CODES=["asdasd"] aws-s3-signed-url-generator
```

## API documentation
See /openapi/media-service.yaml for details!

### Example request
```
curl -XGET -H 'Authorization: <API_CODE>' -H "Content-type: application/json" -d '{"bucket": <BUCKET_NAME>,"key": <OBJECT_NAME>,"operation": <getObject or putObject>,"expires":<EXPIRES_IN>}' 'http://localhost:8080/signed-url'
```

## Environmental variables
The following environment variables are used by the application:

| Variable Name         | Description                           |Required   |Default Value|
|-----------------------|---------------------------------------|-----------|-------------|
| `PORT`                | REST API port                         | No        | 8080       |
| `AWS_REGION`          | Region of the used bucket(s)          | No        | eu-north-1 |
| `API_CODES`           | An array of valid API keys            | No (probably you should)| []         |

